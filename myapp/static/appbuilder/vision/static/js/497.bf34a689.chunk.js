"use strict";(self.webpackChunkvite_ml_platform=self.webpackChunkvite_ml_platform||[]).push([[497],{87497:function(e,s,t){t.r(s),t.d(s,{default:function(){return C}});var n=t(50678),a=t(72791),i=t(23695),d=t(47528),r=t(83099),l=t(28183),c=t(64564),o=t(87309),u=t(618),m=t(48757),x=t(99154),p=t(58105),f=t(20135),h=t(58646),j=t(66106),Z=t(30914),g=t(79286),y=t(60238),_=t(80184),v=(p.Z.Option,f.Z.TextArea);function b(e){console.log(e.showEdit);var s=h.Z.useForm(),t=(0,n.Z)(s,1)[0];(0,a.useEffect)((function(){t.resetFields(),t.setFieldsValue(e.form)}));return(0,_.jsxs)(h.Z,{form:t,name:"dynamic_form_nest_item",className:"structure-form",labelAlign:"left",labelCol:{span:4},onFinish:function(s){var t={};s.config&&s.config.forEach((function(e){t[e.name]={type:e.type,tag:e.tag,json:e.json,des:e.des}}));var n={struct_name:s.struct_name,des:s.des,status:1,admin:s.admin,config:JSON.stringify(t)};e.form.version?(n.version=e.form.version+1,y.Z.mod_struct({opr:"mod_struct",data:n}).then((function(s){console.log(s),0===s.status?(i.ZP.success(s.message),e.resFied()):i.ZP.error(s.message)}))):y.Z.add_struct({opr:"add_struct",data:n}).then((function(s){0===s.status?(i.ZP.success(s.message),e.resFied()):i.ZP.error(s.message)}))},autoComplete:"off",children:[(0,_.jsxs)(j.Z,{gutter:10,children:[(0,_.jsx)(Z.Z,{span:13,children:(0,_.jsx)(h.Z.Item,{name:"struct_name",label:"\u7ed3\u6784\u4f53\u540d",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7ed3\u6784\u540d"}],children:(0,_.jsx)(f.Z,{disabled:!e.isadd})})}),(0,_.jsxs)(Z.Z,{span:24,children:[(0,_.jsxs)(j.Z,{style:{width:"100%"},children:[(0,_.jsx)(Z.Z,{span:4,children:(0,_.jsx)("div",{className:"config-title",children:"\u5b57\u6bb5\u540d"})}),(0,_.jsx)(Z.Z,{span:4,children:(0,_.jsx)("div",{className:"config-title",children:"\u5b57\u6bb5\u7c7b\u578b"})}),(0,_.jsx)(Z.Z,{span:4,children:(0,_.jsx)("div",{className:"config-title",children:"\u5b57\u6bb5Tag"})}),(0,_.jsx)(Z.Z,{span:4,children:(0,_.jsx)("div",{className:"config-title",children:"\u5b57\u6bb5\u63cf\u8ff0"})})]}),(0,_.jsx)(h.Z.List,{name:"config",children:function(s,t){var n=t.add,a=t.remove;return(0,_.jsxs)(_.Fragment,{children:[s.map((function(s){return(0,_.jsxs)(j.Z,{style:{width:"100%"},children:[(0,_.jsx)(Z.Z,{span:4,children:(0,_.jsx)(h.Z.Item,{className:"config-item",name:[s.name,"name"],rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5b57\u6bb5\u540d"}],children:(0,_.jsx)(f.Z,{disabled:!e.isadd,placeholder:"\u8bf7\u8f93\u5165"})})}),(0,_.jsx)(Z.Z,{span:4,children:(0,_.jsx)(h.Z.Item,{className:"config-item",name:[s.name,"type"],rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5b57\u6bb5\u7c7b\u578b"}],children:(0,_.jsxs)(p.Z,{placeholder:"\u8bf7\u9009\u62e9",disabled:!e.isadd,children:[(0,_.jsx)(p.Z.Option,{value:"string",children:"string"},"0"),(0,_.jsx)(p.Z.Option,{value:"int",children:"int"},"1"),(0,_.jsx)(p.Z.Option,{value:"number",children:"number"},"2")]})})}),(0,_.jsx)(Z.Z,{span:4,children:(0,_.jsx)(h.Z.Item,{className:"config-item",name:[s.name,"tag"],children:(0,_.jsx)(f.Z,{disabled:!e.isadd,placeholder:"\u8bf7\u8f93\u5165"})})}),(0,_.jsx)(Z.Z,{span:4,children:(0,_.jsx)(h.Z.Item,{className:"config-item",name:[s.name,"des"],children:(0,_.jsx)(f.Z,{disabled:!e.isadd,placeholder:"\u8bf7\u8f93\u5165"})})}),(0,_.jsx)(Z.Z,{span:4,children:(0,_.jsx)(h.Z.Item,{className:"config-item",children:(0,_.jsx)(o.Z,{disabled:!e.isadd,style:{marginLeft:"10px"},onClick:function(){a(s.name)},children:"\u5220\u9664"})})})]},s.key)})),(0,_.jsx)(h.Z.Item,{children:(0,_.jsx)(o.Z,{disabled:!e.isadd,style:{margin:"10px 0px",width:"66.7%"},type:"dashed",onClick:function(){return n()},block:!0,icon:(0,_.jsx)(g.Z,{}),children:"\u589e\u52a0"})})]})}})]}),(0,_.jsx)(Z.Z,{span:13,children:(0,_.jsx)(h.Z.Item,{name:"des",label:"\u63cf\u8ff0",children:(0,_.jsx)(v,{rows:4,disabled:!e.isadd})})}),(0,_.jsx)(Z.Z,{span:13,children:(0,_.jsx)(h.Z.Item,{name:"admin",label:"\u8d1f\u8d23\u4eba",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8d1f\u8d23\u4eba"}],children:(0,_.jsx)(f.Z,{disabled:!e.isadd})})})]}),e.isadd?(0,_.jsx)(h.Z.Item,{children:(0,_.jsx)(o.Z,{type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})}):null]})}var k={struct_name:"",status:0,admin:"",time:""},I=[{type:"input",name:"struct_name",label:"\u7ed3\u6784\u4f53\u540d"},{type:"select",name:"status",label:"\u72b6\u6001",options:[{value:-1,label:"\u5931\u6548"},{value:0,label:"\u6709\u6548"},{value:1,label:"\u521b\u5efa\u6210\u529f"},{value:2,label:"\u6d4b\u8bd5\u53d1\u5e03"},{value:3,label:"\u6b63\u5f0f\u53d1\u5e03"},{value:4,label:"\u516c\u6709"},{value:5,label:"\u79c1\u6709"}]},{type:"input",name:"admin",label:"\u8d1f\u8d23\u4eba"},{type:"rangePicker",name:"time",label:"\u66f4\u65b0\u65f6\u95f4"}],T=t(17097);function C(){var e=(0,a.useState)(!1),s=(0,n.Z)(e,2),t=s[0],p=s[1],f=(0,a.useState)([]),h=(0,n.Z)(f,2),j=h[0],Z=h[1],g=(0,a.useState)([]),v=(0,n.Z)(g,2),C=v[0],w=v[1],N=(0,a.useState)({}),P=(0,n.Z)(N,2),S=P[0],q=P[1],F=(0,a.useState)(!1),O=(0,n.Z)(F,2),E=O[0],Q=O[1],A=(0,a.useState)(!1),J=(0,n.Z)(A,2),L=J[0],D=J[1],R=[{title:"#",render:function(e,s,t){return(0,_.jsx)("a",{children:t+1+""})}},{title:"\u7c7b\u578b",dataIndex:"type",key:"type"},{title:"\u7248\u672c",dataIndex:"version",key:"version"},{title:"\u5de5\u5382\u540d",dataIndex:"factory_name",key:"factory_name"},{title:"\u540d\u79f0",dataIndex:"name",key:'"name'},{title:"\u72b6\u6001",dataIndex:"status",key:"status",render:function(e){return(0,_.jsx)(d.Z,{color:T.a[e]?T.a[e]:"",children:T.Q[e]?T.Q[e]:""})}},{title:"\u8d1f\u8d23\u4eba",dataIndex:"admin",key:"admin"},{title:"\u63cf\u8ff0",dataIndex:"des",key:"des"},{title:"\u66f4\u65b0\u65f6\u95f4",dataIndex:"updated_time",key:"updated_time"}],z=[{title:"#",dataIndex:"bussiness_id",key:"bussiness_id",render:function(e,s,t){return(0,_.jsx)("a",{children:t+1+""})}},{title:"\u7ed3\u6784\u4f53\u540d",fType:"input",dataIndex:"struct_name",key:"struct_name"},{title:"\u72b6\u6001",dataIndex:"status",key:"status",render:function(e){return(0,_.jsx)(d.Z,{color:T.a[e]?T.a[e]:"",children:T.Q[e]?T.Q[e]:""})}},{title:"\u8d1f\u8d23\u4eba",fType:"input",dataIndex:"admin",key:"admin"},{title:"\u63cf\u8ff0",fType:"textArea",dataIndex:'"des',key:'"des'},{title:"\u66f4\u65b0\u65f6\u95f4",fType:"input",dataIndex:"updated_time",key:"updated_time"},{title:"\u64cd\u4f5c",key:"action",render:function(e,s){return(0,_.jsxs)(r.Z,{size:"middle",children:[(0,_.jsx)("a",{onClick:function(){var e=[],t=JSON.parse(s.config);for(var n in console.log(t),t)e.push({name:n,type:t[n].type,tag:t[n].tag,json:t[n].json,des:t[n].des});var a={struct_name:s.struct_name,status:s.status,des:s.des,admin:s.admin,config:e};Q(!1),q(a),p(!0)},children:"\u67e5\u770b"},"view"),(0,_.jsx)("span",{style:{color:"#999",marginTop:"-1px"},children:" | "}),(0,_.jsx)("a",{onClick:function(){var e=[],t=JSON.parse(s.config);for(var n in console.log(t),t)e.push({name:n,type:t[n].type,tag:t[n].tag,json:t[n].json,des:t[n].des});var a={struct_name:s.struct_name,status:s.status,des:s.des,admin:s.admin,config:e,version:s.version};Q(!0),q(a),p(!0)},children:"\u7f16\u8f91"},"edit"),(0,_.jsx)("span",{style:{color:"#999",marginTop:"-1px"},children:" | "}),(0,_.jsx)(l.Z,{title:"\u662f\u5426\u5220\u9664?",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onConfirm:function(){B(s)},children:(0,_.jsx)("a",{children:"\u5220\u9664"},"del")}),(0,_.jsx)("span",{style:{color:"#999",marginTop:"-1px"},children:" | "}),s.associated_nodes&&s.associated_nodes.length?(0,_.jsxs)("a",{onClick:function(){!function(e){var s={opr:"query_associated_nodes",data:{associated_nodes:e.associated_nodes}};y.Z.query_associated_nodes(s).then((function(e){console.log(e),0===e.status?(w(e.data.results),D(!0),i.ZP.success(e.message)):(Z([]),i.ZP.error(e.message))}))}(s)},children:[" \u5173\u8054\u8282\u70b9 (",s.associated_nodes&&s.associated_nodes.length?s.associated_nodes.length:0," )"]},"node"):(0,_.jsx)("span",{style:{color:"#999"},children:"\u5173\u8054\u8282\u70b9"})]})}}],V=z.filter((function(e){return e.fType})).map((function(e){return{type:e.fType,name:e.dataIndex,label:e.title}})),Y=function(e){var s=e.admin,t=e.struct_name,n=e.status,a=e.time,d={struct_name:t||"",admin:s||"",status:n||0,min_updated_time:a&&a[0]?new Date(a[0]).getTime():0,max_updated_time:a&&a[1]?new Date(a[1]).getTime():0};y.Z.query_structs({opr:"query_structs",data:d}).then((function(e){0===e.status?(Z(e.data.results),i.ZP.success(e.message)):i.ZP.error(e.message)}))};(0,a.useEffect)((function(){Y({})}),[]);var B=function(e){var s={opr:"delete_struct",data:{struct_name:e.struct_name}};y.Z.delete_struct(s).then((function(e){console.log(e),0===e.status?(i.ZP.success(e.message),Y({})):i.ZP.error(e.message)}))};return(0,_.jsxs)("div",{style:{padding:"30px 40px"},children:[(0,_.jsxs)("div",{children:[(0,_.jsx)(c.Z,{title:"\u67e5\u8be2\u6761\u4ef6",children:(0,_.jsx)(x.Z,{formRolue:I,form:k,queryList:Y})}),(0,_.jsx)(c.Z,{title:"\u67e5\u8be2\u7ed3\u679c",extra:(0,_.jsx)(o.Z,{type:"primary",onClick:function(){return Q(!0),q({name:""}),void p(!0)},children:"\u65b0\u589e"}),style:{marginTop:"20px"},children:(0,_.jsx)(u.Z,{columns:z,dataSource:j},"struct_name")})]}),(0,_.jsx)(m.Z,{width:900,title:"",visible:t,onCancel:function(){p(!1)},footer:[(0,_.jsx)(o.Z,{onClick:function(){p(!1)},children:"\u5173\u95ed"},"back")],children:(0,_.jsx)(b,{formRolue:V,form:S,isadd:E,disableds:!0,resFied:function(){p(!1),Y({})}})}),(0,_.jsx)(m.Z,{width:"60%",title:"\u5173\u8054\u8282\u70b9",visible:L,onCancel:function(){D(!1)},footer:[(0,_.jsx)(o.Z,{onClick:function(){D(!1)},children:"\u5173\u95ed"},"back")],children:(0,_.jsx)("div",{style:{width:"100%",overflowY:"auto"},children:(0,_.jsx)(u.Z,{columns:R,dataSource:C},"struct_name")})})]})}}}]);