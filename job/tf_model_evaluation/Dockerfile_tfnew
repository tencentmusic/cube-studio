FROM tensorflow/tensorflow:2.6.0

RUN pip uninstall -y protobuf && \
    pip install protobuf -i https://mirrors.tencent.com/pypi/simple && \
    pip install nni -i https://mirrors.tencent.com/pypi/simple && \
    pip install tensorflow_datasets -i https://mirrors.tencent.com/pypi/simple && \
    pip install sklearn -i https://mirrors.tencent.com/pypi/simple && \
    pip install sklearn_pandas -i https://mirrors.tencent.com/pypi/simple && \
    pip install scipy -i https://mirrors.tencent.com/pypi/simple && \
    pip install gensim -i https://mirrors.tencent.com/pypi/simple && \
    pip install prettytable -i https://mirrors.tencent.com/pypi/simple

COPY tensorflow_recommenders_addons-0.3.0.dev0-cp36-cp36m-linux_x86_64.whl /tmp/
RUN pip3 install /tmp/tensorflow_recommenders_addons-0.3.0.dev0-cp36-cp36m-linux_x86_64.whl

COPY job/pkgs /app/job/pkgs
COPY job/model_template /app/job/model_template
COPY job/tf_model_evaluation/*.py /app/job/tf_model_evaluation/

WORKDIR /app
ENTRYPOINT ["python", "-m", "job.tf_model_evaluation.model_evaluation"]